项目：电信计费系统之数据采集子系统(DMS)
一、背景介绍
  电信：主机租赁业务
  公司、科研院所、高校等：为了某个项目、某项研究短时间需要某一服务器或其中的功能

  计费方式：按时间收费

  结构框图： 参见：01_dms.pdf


     
二、项目流程 

  1.需求分析
    按照软件工程的要求，复述用户的需求，得到用户和设计人员的认可
      三层含义：
              依据：软件工程的要求
              复述：对用户的要求进行分析、加工、归纳
                    用户的需求通常是零散的、无逻辑的、业务的
              目标：要得到用户和设计人员的认可
                    用户：满足或超越用户的要求
                    设计人员：可行性
   
   1）用例：功能特性。
   2）事件流：功能的执行过程
   3）异常流：针对事件流中的各种意外情况的处理。
   4）前置条件：事件流中每一个步骤所依赖的条件。
   5）后置条件：事件流中每一个步骤所产生的结果。

   撰写并评审《需求规格说明书》。

   产品部门 需求分析工程师


  2.概要设计
   根据需求分析构思系统的主要框架。
   面向过程的主框架：关注需求中的事件流。
   面向对象的主框架：关注需求中的用例和角色。
   找到对象！
   读取文件，形成记录
   主语 + 谓语 + 宾语 
   根据主语找到对象：日志读取器
   根据谓语确定行为：读取（文件）、形成（记录）
   根据宾语找到对象：文件、记录
   根据谓语确定行为：文件.读取()、记录.形成()


   软件工程中把面向对象的主框架概括成一种模型：
   接口驱动：关注事件，事件由对象触发，谁导致事件发生谁就是对象。
   模型驱动：关注数据，数据通常是对象的属性，谁拥有这些属性谁就是对象。
   异常驱动：把不同的异常看做不同的对象类型。

   撰写并评审《概要设计说明书》、《开发计划和测试计划》

 3.详细设计（UML--统一建模语言）
  1）根据对象抽象为类，形成类图；    
  2）对类分配责任，即主要成员函数；
  3）通过时序图表现并验证类的成员函数如何实现事件流；
  4）根据前置条件、后置条件和中间变量，设计类的成员变量；
  5）设计成员函数的细节：返回值、参数、函数名、常属性、访问控制、异常说明
  6）设计每个成员函数的内部执行过程：活动图/状态图；
     活动图：流程图  07_client_activity.pdf
     状态图：        08_client_state.pdf
  7）补充其他细节：构造函数、析构函数、深拷贝、操作符，等等；
  8）通过继承和多态引入抽象；
  9）适度套用设计模式。
  
  撰写并评审《详细设计说明书》
  每个模块 由相关人员完成
 

 4.编写代码和测试用例
   开发人员：编写代码
   测试人员：编写测试用例
 
 5.测试验证和修改错误
    
 6.产品发布和工程实施

 7.项目总结
    


三、数据采集客户机
 1.用例描述  
   
   数据采集客户机备份并读取日志文件，形成匹配日志记录，通过网络发送给数据采集服务器
  
   
   读取日志文件：
   数据先备份，避免在读取数据过程中由于登录日志的改变造成读写冲突
   

   形成匹配日志记录：
   证明只要是同一用户、在同一台机器、用同一个客户端所形成的登入和登出就叫做匹配。
   把匹配的结果形成一个个数据包，比如一个匹配结果就是一个小包，通过网路发送给服务器，记录到数据库中

   绘制用例图  02_client_usecase.pdf
   描述：系统管理员通过数据采集客户机，借助日志读取器来备份并读取登录日志文件，形成匹配记录，
   交由日志发送器，通过网络发送给给数据采集客户机

   
  2.参与者
   1）系统管理员：数据采集客户机的启动者，人/定时任务管理器/进程入口(main)函数。
   2）数据采集客户机：提供启动数据采集过程的单一接口。
   3）日志读取器：备份并读取日志文件，形成匹配日志记录
   4）日志发送器：将日志读取器匹配好的日志记录，通过网络发送给数据采集服务器。

   典型的接口驱动

  3.基本事件流
   1）备份系统日志，产生备份文件，以日期和时间作为后缀，如：
      wtmpx.20170725101510,同时将系统日志清空；
  
   2) 读取备份文件，产生登入登出日志记录；
      需求说明中，有数据的格式，其中黄色标注的是我们感兴趣的。
      登录名、登录IP、登录进程PID、登入登出时间
      其中前三项是匹配依据，登入登出时间是计费依据

   3）匹配登入登出日志记录，生成匹配日志记录：登录名、登录IP、登录进程PID、登入时间、登出时间、登录时段
  
   4）根据数据采集服务器的IP地址和侦听端口向其发送连接请求，建立TCP连接；

   5）将匹配日志记录发送到数据采集服务器

  4.异常事件流
   1）备份异常：终止采集；
   2）读取异常：终止采集；
   3）只有登出，没有登入；忽略   可能是系统上线前的数据、优惠活动等
      只有登入，没有登出；存入登录文件，以期下次匹配；
   4）连接服务器失败：将全部匹配日志记录存入发送失败文件，下次采集时重发；
   5）发送过程中失败：将剩余未及发出匹配日志记录，存入发送失败文件。
   
  5.前置条件
   1）日志文件路径：/var/adm/wtmpx   存入 ./wtmpx
   2）登入文件路径：./logins.dat
   3) 发送失败文件路径：./fail.dat
   4) 数据采集服务器的IP和端口。

  6.后置条件
    匹配日志记录集

  7.类图
   客户端数据对象：03_client.data.pdf
      LogRec：日志记录

      MLogRec：匹配日志记录集

   异常：          04_client_exception.pdf

   
      采用继承的方式定义异常，等易于捕获异常   
 
   主体部分类图：  05_client_class.pdf
    
       
   
  8.时序图
    06_client_sequence.pdf

  9.活动图/状态图
    活动图：07_client_activity.pdf
      
    状态图：08_client_state.pdf
     
    
  10.编写代码
   
